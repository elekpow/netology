# Домашнее задание к занятию «Резервное копирование баз данных» <br/> Игорь Левин

---

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

*Приведите ответ в свободной форме.*


---

**Выполнение задания 1.**


Кейс 1.1 Для восстановления данных в полном объеме за предыдущий день, необходимо осуществить Полное резервное копирование , однако это требует значительного пространства для хранения и
больше времени для восстановления.  Также применяют инкрементное резервного копирование, при использовании этого метода создается полная копия данных только в первый раз,а затем создаются последующие инкрементные копии измененных или новых файлов. Инкрементное резервного копирование более экономичное в плане использования пространства для хранения и времени создания резервной копии.

Кейс 1.2

Если необходимо восстанавить данные за час до предполагаемой поломки, то в этом случае необходимо что бы осуществлялось непрерывное резервное копирование. Метод позволяет резервировать данные на постоянной основе, практически в режиме реального времени. Также можно делать частые резервные копии, например критически важные данные  с краткими интервалами времени. Пременение дифференциальных и инкрементальных бэкапов повзволило бы ускорить восстановние данных. Дифференциальный бэкап содержит изменения в данных относительно полного бэкапа, инкрементальный — содержит изменения со времени последнего частичного бэкапа – последней инкрементальной копии. Что бы ускорить восстановление можно осуществлять инкрементальное резервное копирование только тех таблиц, данных которые изменились с момента предыдущего резервного копирования. 


Кейс 1.3

Применение сервера для репликации базы данных, позволит переключиться на рабочую базу данных. В то время может быть осуществлен ремнот и восстаноление основного сервера.  


---

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

*Приведите ответ в свободной форме.*

---

**Выполнение задания 2.**


2.1. PostgreSQL — это объектно-реляционная система управления базами данных.


**PostgreSQL, создание резервных копий:**

Создание дампа базы данных:

```
pg_dump <parametrs> <db_name> > "path/file.dump"
```

Выгрузка отдельной таблицы mytab:
```
pg_dump -t "mytab" <db_name> > "path/file.dump"
```

**Восстановление базы данных:**

```
pg_restore -d postgres --clean --create db.dump

```

**-d — имя базы данных.**
**-clean — добавление операторов DROP перед операторами CREATE.**


Восстановить определнную таблицу базы данных:
```
pg_restore -a -t tbl "path/file.dump"
```

2.1.* автоматизация процесса резервирования данных и восстановления БД 








---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

*Приведите ответ в свободной форме.*

---

**Выполнение задания 3.**


полное резервное копирование:

*Дамп базы данных и копирование на другой сервер**

на master сервере: в консоли **mysql** выполняем:`FLUSH TABLES WITH READ LOCK;`, затем выходим `\q` и выполняем Дамп:
```
mysqldump -v  -uroot -p  --all-databases --master-data > /tmp/dump/dump.sql

```
подключаемся к севреру  ` mysql -u root -p` и разблокируем таблицы `UNLOCK TABLES;`


**Создание инкрементных бекапа:**

```
mysqldump -uroot -p --all-databases --single-transaction --flush-logs --master-data=2 > full_backup.sql
```

при создании полного бекапа используем флаг ** --flush-logs**,  закроет текущие журналы (mysql-bin.000001) и создаст новый (mysql-bin.000002).


Очистим log:
```
mysqladmin -uroot -p flush-logs
```

Восстановление данных MySQL из двоичного журнала, сохраненного в файле mysql-bin.000002.

```
mysqlbinlog /var/log/mysql/mysql-bin.000002 | mysql -uroot -p mydb
```






3.1.* 








---
